  pytorch_short_perf_test_gpu:
    environment:
      BUILD_ENVIRONMENT: pytorch-short-perf-test-gpu
      DOCKER_IMAGE: "308535385114.dkr.ecr.us-east-1.amazonaws.com/pytorch/pytorch-linux-xenial-cuda8-cudnn7-py3:282"
      PYTHON_VERSION: "3.6"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    machine:
      image: default
    steps:
    - run:
        <<: *setup_linux_system_environment
    - run:
        <<: *setup_ci_environment
    - run:
        name: Perf Test
        no_output_timeout: "1h"
        command: |
          set -e
          export COMMIT_DOCKER_IMAGE=${DOCKER_IMAGE}-${CIRCLE_SHA1}
          echo "DOCKER_IMAGE: "${COMMIT_DOCKER_IMAGE}
          docker pull ${COMMIT_DOCKER_IMAGE} >/dev/null
          export id=$(docker run --runtime=nvidia -t -d -w /var/lib/jenkins ${COMMIT_DOCKER_IMAGE})

          docker cp $id:/var/lib/jenkins/workspace/env /home/circleci/project/env
          # This IAM user allows write access to S3 bucket for perf test numbers
          echo "declare -x AWS_ACCESS_KEY_ID=${CIRCLECI_AWS_ACCESS_KEY_FOR_PERF_TEST_S3_BUCKET_V3}" >> /home/circleci/project/env
          echo "declare -x AWS_SECRET_ACCESS_KEY=${CIRCLECI_AWS_SECRET_KEY_FOR_PERF_TEST_S3_BUCKET_V3}" >> /home/circleci/project/env
          docker cp /home/circleci/project/env $id:/var/lib/jenkins/workspace/env

          export COMMAND='((echo "export BUILD_ENVIRONMENT=${BUILD_ENVIRONMENT}" && echo "source ./workspace/env" && echo "sudo chown -R jenkins workspace && cd workspace && .jenkins/pytorch/short-perf-test-gpu.sh") | docker exec -u jenkins -i "$id" bash) 2>&1'
          echo ${COMMAND} > ./command.sh && unbuffer bash ./command.sh | ts

  pytorch_doc_push:
    environment:
      BUILD_ENVIRONMENT: pytorch-doc-push
      DOCKER_IMAGE: "308535385114.dkr.ecr.us-east-1.amazonaws.com/pytorch/pytorch-linux-xenial-cuda8-cudnn7-py3:282"
    resource_class: large
    machine:
      image: default
    steps:
    - run:
        <<: *setup_linux_system_environment
    - run:
        <<: *setup_ci_environment
    - run:
        <<: *install_doc_push_script
    - run:
        name: Doc Build and Push
        no_output_timeout: "1h"
        command: |
          set -e
          export COMMIT_DOCKER_IMAGE=${DOCKER_IMAGE}-${CIRCLE_SHA1}
          echo "DOCKER_IMAGE: "${COMMIT_DOCKER_IMAGE}
          docker pull ${COMMIT_DOCKER_IMAGE} >/dev/null
          export id=$(docker run -t -d -w /var/lib/jenkins ${COMMIT_DOCKER_IMAGE})

          docker cp /home/circleci/project/doc_push_script.sh $id:/var/lib/jenkins/workspace/doc_push_script.sh

          # master branch docs push
          if [[ "${CIRCLE_BRANCH}" == "master" ]]; then
            export COMMAND='((echo "export BUILD_ENVIRONMENT=${BUILD_ENVIRONMENT}" && echo "source ./workspace/env" && echo "sudo chown -R jenkins workspace && cd workspace && ./doc_push_script.sh docs/master master") | docker exec -u jenkins -i "$id" bash) 2>&1'

          # stable release docs push. Due to some circleci limitations, we keep
          # an eternal PR open (#16502) for merging v1.0.1 -> master for this job.
          # XXX: The following code is only run on the v1.0.1 branch, which might
          # not be exactly the same as what you see here.
          elif [[ "${CIRCLE_BRANCH}" == "v1.0.1" ]]; then
            export COMMAND='((echo "export BUILD_ENVIRONMENT=${BUILD_ENVIRONMENT}" && echo "source ./workspace/env" && echo "sudo chown -R jenkins workspace && cd workspace && ./doc_push_script.sh docs/stable 1.0.1") | docker exec -u jenkins -i "$id" bash) 2>&1'

          # For open PRs: Do a dry_run of the docs build, don't push build
          else
            export COMMAND='((echo "export BUILD_ENVIRONMENT=${BUILD_ENVIRONMENT}" && echo "source ./workspace/env" && echo "sudo chown -R jenkins workspace && cd workspace && ./doc_push_script.sh docs/master master dry_run") | docker exec -u jenkins -i "$id" bash) 2>&1'
          fi

          echo ${COMMAND} > ./command.sh && unbuffer bash ./command.sh | ts

          # Save the docs build so we can debug any problems
          export DEBUG_COMMIT_DOCKER_IMAGE=${COMMIT_DOCKER_IMAGE}-debug
          docker commit "$id" ${DEBUG_COMMIT_DOCKER_IMAGE}
          docker push ${DEBUG_COMMIT_DOCKER_IMAGE}

  pytorch_macos_10_13_py3_build:
    macos:
      xcode: "9.0"
    steps:
      - checkout
      - run:
          <<: *macos_brew_update
      - run:
          name: Build
          environment:
            BUILD_ENVIRONMENT: pytorch-macos-10.13-py3-build
          no_output_timeout: "1h"
          command: |
            set -e

            export IN_CIRCLECI=1

            # Install sccache
            sudo curl https://s3.amazonaws.com/ossci-macos/sccache --output /usr/local/bin/sccache
            sudo chmod +x /usr/local/bin/sccache

            export SCCACHE_BUCKET=ossci-compiler-cache-circleci-v2
            # This IAM user allows write access to S3 bucket for sccache
            export AWS_ACCESS_KEY_ID=${CIRCLECI_AWS_ACCESS_KEY_FOR_SCCACHE_S3_BUCKET_V3}
            export AWS_SECRET_ACCESS_KEY=${CIRCLECI_AWS_SECRET_KEY_FOR_SCCACHE_S3_BUCKET_V3}

            chmod a+x .jenkins/pytorch/macos-build.sh
            unbuffer .jenkins/pytorch/macos-build.sh 2>&1 | ts

            mkdir -p /Users/distiller/pytorch-ci-env/workspace

            # copy with -a to preserve relative structure (e.g., symlinks), and be recursive
            cp -a /Users/distiller/project/. /Users/distiller/pytorch-ci-env/workspace
      - persist_to_workspace:
          root: /Users/distiller/pytorch-ci-env
          paths:
            - "*"

  pytorch_macos_10_13_py3_test:
    macos:
      xcode: "9.0"
    steps:
      - run:
          name: Prepare workspace
          command: |
            sudo mkdir -p /Users/distiller/pytorch-ci-env
            sudo chmod -R 777 /Users/distiller/pytorch-ci-env
      - attach_workspace:
          at: /Users/distiller/pytorch-ci-env
      - run:
          <<: *macos_brew_update
      - run:
          name: Test
          environment:
            BUILD_ENVIRONMENT: pytorch-macos-10.13-py3-test
          no_output_timeout: "1h"
          command: |
            set -e
            export IN_CIRCLECI=1

            # copy with -a to preserve relative structure (e.g., symlinks), and be recursive
            cp -a /Users/distiller/pytorch-ci-env/workspace/. /Users/distiller/project

            chmod a+x .jenkins/pytorch/macos-test.sh
            unbuffer .jenkins/pytorch/macos-test.sh 2>&1 | ts

  pytorch_macos_10_13_cuda9_2_cudnn7_py3_build:
    macos:
      xcode: "9.0"
    steps:
      - checkout
      - run:
          <<: *macos_brew_update
      - run:
          name: Build
          environment:
            BUILD_ENVIRONMENT: pytorch-macos-10.13-cuda9.2-cudnn7-py3-build
          no_output_timeout: "1h"
          command: |
            set -e

            export IN_CIRCLECI=1

            # Install CUDA 9.2
            sudo rm -rf ~/cuda_9.2.64_mac_installer.app || true
            curl https://s3.amazonaws.com/ossci-macos/cuda_9.2.64_mac_installer.zip -o ~/cuda_9.2.64_mac_installer.zip
            unzip ~/cuda_9.2.64_mac_installer.zip -d ~/
            sudo ~/cuda_9.2.64_mac_installer.app/Contents/MacOS/CUDAMacOSXInstaller --accept-eula --no-window
            sudo cp /usr/local/cuda/lib/libcuda.dylib /Developer/NVIDIA/CUDA-9.2/lib/libcuda.dylib
            sudo rm -rf /usr/local/cuda || true

            # Install cuDNN 7.1 for CUDA 9.2
            curl https://s3.amazonaws.com/ossci-macos/cudnn-9.2-osx-x64-v7.1.tgz -o ~/cudnn-9.2-osx-x64-v7.1.tgz
            rm -rf ~/cudnn-9.2-osx-x64-v7.1 && mkdir ~/cudnn-9.2-osx-x64-v7.1
            tar -xzvf ~/cudnn-9.2-osx-x64-v7.1.tgz -C ~/cudnn-9.2-osx-x64-v7.1
            sudo cp ~/cudnn-9.2-osx-x64-v7.1/cuda/include/cudnn.h /Developer/NVIDIA/CUDA-9.2/include/
            sudo cp ~/cudnn-9.2-osx-x64-v7.1/cuda/lib/libcudnn* /Developer/NVIDIA/CUDA-9.2/lib/
            sudo chmod a+r /Developer/NVIDIA/CUDA-9.2/include/cudnn.h /Developer/NVIDIA/CUDA-9.2/lib/libcudnn*

            # Install sccache
            sudo curl https://s3.amazonaws.com/ossci-macos/sccache --output /usr/local/bin/sccache
            sudo chmod +x /usr/local/bin/sccache
            export SCCACHE_BUCKET=ossci-compiler-cache-circleci-v2
            # This IAM user allows write access to S3 bucket for sccache
            export AWS_ACCESS_KEY_ID=${CIRCLECI_AWS_ACCESS_KEY_FOR_SCCACHE_S3_BUCKET_V3}
            export AWS_SECRET_ACCESS_KEY=${CIRCLECI_AWS_SECRET_KEY_FOR_SCCACHE_S3_BUCKET_V3}

            git submodule sync && git submodule update -q --init
            chmod a+x .jenkins/pytorch/macos-build.sh
            unbuffer .jenkins/pytorch/macos-build.sh 2>&1 | ts

  caffe2_py2_cuda9_0_cudnn7_ubuntu16_04_build:
    environment:
      BUILD_ENVIRONMENT: "caffe2-py2-cuda9.0-cudnn7-ubuntu16.04-build"
      DOCKER_IMAGE: "308535385114.dkr.ecr.us-east-1.amazonaws.com/caffe2/py2-cuda9.0-cudnn7-ubuntu16.04:248"
    <<: *caffe2_linux_build_defaults

  caffe2_py2_cuda9_0_cudnn7_ubuntu16_04_test:
    environment:
      DOCKER_IMAGE: "308535385114.dkr.ecr.us-east-1.amazonaws.com/caffe2/py2-cuda9.0-cudnn7-ubuntu16.04:248"
      USE_CUDA_DOCKER_RUNTIME: "1"
      BUILD_ENVIRONMENT: "caffe2-py2-cuda9.0-cudnn7-ubuntu16.04-test"
    resource_class: gpu.medium
    <<: *caffe2_linux_test_defaults

  caffe2_cmake_cuda9_0_cudnn7_ubuntu16_04_build:
    environment:
      DOCKER_IMAGE: "308535385114.dkr.ecr.us-east-1.amazonaws.com/caffe2/py2-cuda9.0-cudnn7-ubuntu16.04:248"
      BUILD_ENVIRONMENT: "caffe2-cmake-cuda9.0-cudnn7-ubuntu16.04-build"
    <<: *caffe2_linux_build_defaults

  caffe2_cmake_cuda9_0_cudnn7_ubuntu16_04_test:
    environment:
      DOCKER_IMAGE: "308535385114.dkr.ecr.us-east-1.amazonaws.com/caffe2/py2-cuda9.0-cudnn7-ubuntu16.04:248"
      USE_CUDA_DOCKER_RUNTIME: "1"
      BUILD_ENVIRONMENT: "caffe2-cmake-cuda9.0-cudnn7-ubuntu16.04-test"
    resource_class: gpu.medium
    <<: *caffe2_linux_test_defaults

  caffe2_py2_cuda9_1_cudnn7_ubuntu16_04_build:
    environment:
      BUILD_ENVIRONMENT: "caffe2-py2-cuda9.1-cudnn7-ubuntu16.04-build"
      DOCKER_IMAGE: "308535385114.dkr.ecr.us-east-1.amazonaws.com/caffe2/py2-cuda9.1-cudnn7-ubuntu16.04:248"
    <<: *caffe2_linux_build_defaults

  caffe2_py2_cuda9_1_cudnn7_ubuntu16_04_test:
    environment:
      DOCKER_IMAGE: "308535385114.dkr.ecr.us-east-1.amazonaws.com/caffe2/py2-cuda9.1-cudnn7-ubuntu16.04:248"
      USE_CUDA_DOCKER_RUNTIME: "1"
      BUILD_ENVIRONMENT: "caffe2-py2-cuda9.1-cudnn7-ubuntu16.04-test"
    resource_class: gpu.medium
    <<: *caffe2_linux_test_defaults

  caffe2_py2_mkl_ubuntu16_04_build:
    environment:
      DOCKER_IMAGE: "308535385114.dkr.ecr.us-east-1.amazonaws.com/caffe2/py2-mkl-ubuntu16.04:248"
      BUILD_ENVIRONMENT: "caffe2-py2-mkl-ubuntu16.04-build"
    <<: *caffe2_linux_build_defaults

  caffe2_py2_mkl_ubuntu16_04_test:
    environment:
      DOCKER_IMAGE: "308535385114.dkr.ecr.us-east-1.amazonaws.com/caffe2/py2-mkl-ubuntu16.04:248"
      BUILD_ENVIRONMENT: "caffe2-py2-mkl-ubuntu16.04-test"
    resource_class: large
    <<: *caffe2_linux_test_defaults

  caffe2_py2_gcc4_8_ubuntu14_04_build:
    environment:
      DOCKER_IMAGE: "308535385114.dkr.ecr.us-east-1.amazonaws.com/caffe2/py2-gcc4.8-ubuntu14.04:248"
      BUILD_ENVIRONMENT: "caffe2-py2-gcc4.8-ubuntu14.04-build"
    <<: *caffe2_linux_build_defaults

  caffe2_py2_gcc4_8_ubuntu14_04_test:
    environment:
      DOCKER_IMAGE: "308535385114.dkr.ecr.us-east-1.amazonaws.com/caffe2/py2-gcc4.8-ubuntu14.04:248"
      BUILD_ENVIRONMENT: "caffe2-py2-gcc4.8-ubuntu14.04-test"
    resource_class: large
    <<: *caffe2_linux_test_defaults

  caffe2_onnx_py2_gcc5_ubuntu16_04_build:
    environment:
      DOCKER_IMAGE: "308535385114.dkr.ecr.us-east-1.amazonaws.com/caffe2/py2-gcc5-ubuntu16.04:248"
      BUILD_ENVIRONMENT: "caffe2-onnx-py2-gcc5-ubuntu16.04-build"
    <<: *caffe2_linux_build_defaults

  caffe2_onnx_py2_gcc5_ubuntu16_04_test:
    environment:
      DOCKER_IMAGE: "308535385114.dkr.ecr.us-east-1.amazonaws.com/caffe2/py2-gcc5-ubuntu16.04:248"
      BUILD_ENVIRONMENT: "caffe2-onnx-py2-gcc5-ubuntu16.04-test"
    resource_class: large
    <<: *caffe2_linux_test_defaults

  caffe2_py2_cuda8_0_cudnn7_ubuntu16_04_build:
    environment:
      DOCKER_IMAGE: "308535385114.dkr.ecr.us-east-1.amazonaws.com/caffe2/py2-cuda8.0-cudnn7-ubuntu16.04:248"
      BUILD_ENVIRONMENT: "caffe2-py2-cuda8.0-cudnn7-ubuntu16.04-build"
    <<: *caffe2_linux_build_defaults

  caffe2_py2_cuda8_0_cudnn7_ubuntu16_04_test:
    environment:
      DOCKER_IMAGE: "308535385114.dkr.ecr.us-east-1.amazonaws.com/caffe2/py2-cuda8.0-cudnn7-ubuntu16.04:248"
      USE_CUDA_DOCKER_RUNTIME: "1"
      BUILD_ENVIRONMENT: "caffe2-py2-cuda8.0-cudnn7-ubuntu16.04-test"
    resource_class: gpu.medium
    <<: *caffe2_linux_test_defaults

  caffe2_py2_gcc4_9_ubuntu14_04_build:
    environment:
      DOCKER_IMAGE: "308535385114.dkr.ecr.us-east-1.amazonaws.com/caffe2/py2-gcc4.9-ubuntu14.04:248"
      BUILD_ENVIRONMENT: "caffe2-py2-gcc4.9-ubuntu14.04-build"
      BUILD_ONLY: "1"
    <<: *caffe2_linux_build_defaults

  caffe2_py2_clang3_8_ubuntu16_04_build:
    environment:
      DOCKER_IMAGE: "308535385114.dkr.ecr.us-east-1.amazonaws.com/caffe2/py2-clang3.8-ubuntu16.04:248"
      BUILD_ENVIRONMENT: "caffe2-py2-clang3.8-ubuntu16.04-build"
      BUILD_ONLY: "1"
    <<: *caffe2_linux_build_defaults

  caffe2_py2_clang3_9_ubuntu16_04_build:
    environment:
      DOCKER_IMAGE: "308535385114.dkr.ecr.us-east-1.amazonaws.com/caffe2/py2-clang3.9-ubuntu16.04:248"
      BUILD_ENVIRONMENT: "caffe2-py2-clang3.9-ubuntu16.04-build"
      BUILD_ONLY: "1"
    <<: *caffe2_linux_build_defaults

  caffe2_py2_clang7_ubuntu16_04_build:
    environment:
      DOCKER_IMAGE: "308535385114.dkr.ecr.us-east-1.amazonaws.com/caffe2/py2-clang7-ubuntu16.04:248"
      BUILD_ENVIRONMENT: "caffe2-py2-clang7-ubuntu16.04-build"
      BUILD_ONLY: "1"
    <<: *caffe2_linux_build_defaults

  caffe2_py2_android_ubuntu16_04_build:
    environment:
      DOCKER_IMAGE: "308535385114.dkr.ecr.us-east-1.amazonaws.com/caffe2/py2-android-ubuntu16.04:248"
      BUILD_ENVIRONMENT: "caffe2-py2-android-ubuntu16.04-build"
      BUILD_ONLY: "1"
    <<: *caffe2_linux_build_defaults

  caffe2_py2_cuda9_0_cudnn7_centos7_build:
    environment:
      DOCKER_IMAGE: "308535385114.dkr.ecr.us-east-1.amazonaws.com/caffe2/py2-cuda9.0-cudnn7-centos7:248"
      BUILD_ENVIRONMENT: "caffe2-py2-cuda9.0-cudnn7-centos7-build"
    <<: *caffe2_linux_build_defaults

  caffe2_py2_cuda9_0_cudnn7_centos7_test:
    environment:
      DOCKER_IMAGE: "308535385114.dkr.ecr.us-east-1.amazonaws.com/caffe2/py2-cuda9.0-cudnn7-centos7:248"
      USE_CUDA_DOCKER_RUNTIME: "1"
      BUILD_ENVIRONMENT: "caffe2-py2-cuda9.0-cudnn7-centos7-test"
    resource_class: gpu.medium
    <<: *caffe2_linux_test_defaults

  caffe2_py2_ios_macos10_13_build:
    environment:
      BUILD_ENVIRONMENT: caffe2-py2-ios-macos10.13-build
      BUILD_IOS: "1"
      PYTHON_INSTALLATION: "system"
      PYTHON_VERSION: "2"
    <<: *caffe2_macos_build_defaults

  caffe2_py2_system_macos10_13_build:
    environment:
      BUILD_ENVIRONMENT: caffe2-py2-system-macos10.13-build
      PYTHON_INSTALLATION: "system"
      PYTHON_VERSION: "2"
    <<: *caffe2_macos_build_defaults

# update_s3_htmls job
  update_s3_htmls:
    machine:
      image: default
    steps:
    - run:
        <<: *setup_linux_system_environment
    - run:
        <<: *binary_populate_env
    - run:
        <<: *binary_checkout
    - run:
        name: Update s3 htmls
        no_output_timeout: "1h"
        command: |
          echo "declare -x \"AWS_ACCESS_KEY_ID=${PYTORCH_BINARY_AWS_ACCESS_KEY_ID}\"" >> /home/circleci/project/env
          echo "declare -x \"AWS_SECRET_ACCESS_KEY=${PYTORCH_BINARY_AWS_SECRET_ACCESS_KEY}\"" >> /home/circleci/project/env
          source /home/circleci/project/env
          set -ex
          retry pip install awscli==1.6
          "$BUILDER_ROOT/cron/update_s3_htmls.sh"



##############################################################################
# Binary build specs individual job specifications
##############################################################################
  binary_linux_manywheel_2.7m_cpu_build:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7m cpu"
    docker:
      - image: "soumith/manylinux-cuda80"
    <<: *binary_linux_build

  binary_linux_manywheel_2.7mu_cpu_build:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7mu cpu"
    docker:
      - image: "soumith/manylinux-cuda80"
    <<: *binary_linux_build

  binary_linux_manywheel_3.5m_cpu_build:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.5m cpu"
    docker:
      - image: "soumith/manylinux-cuda80"
    <<: *binary_linux_build

  binary_linux_manywheel_3.6m_cpu_build:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.6m cpu"
    docker:
      - image: "soumith/manylinux-cuda80"
    <<: *binary_linux_build

  binary_linux_manywheel_3.7m_cpu_build:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.7m cpu"
    docker:
      - image: "soumith/manylinux-cuda80"
    <<: *binary_linux_build

  binary_linux_manywheel_2.7m_cu80_build:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7m cu80"
    docker:
      - image: "soumith/manylinux-cuda80"
    <<: *binary_linux_build

  binary_linux_manywheel_2.7mu_cu80_build:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7mu cu80"
    docker:
      - image: "soumith/manylinux-cuda80"
    <<: *binary_linux_build

  binary_linux_manywheel_3.5m_cu80_build:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.5m cu80"
    docker:
      - image: "soumith/manylinux-cuda80"
    <<: *binary_linux_build

  binary_linux_manywheel_3.6m_cu80_build:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.6m cu80"
    docker:
      - image: "soumith/manylinux-cuda80"
    <<: *binary_linux_build

  binary_linux_manywheel_3.7m_cu80_build:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.7m cu80"
    docker:
      - image: "soumith/manylinux-cuda80"
    <<: *binary_linux_build

  binary_linux_manywheel_2.7m_cu90_build:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7m cu90"
    docker:
      - image: "soumith/manylinux-cuda90"
    <<: *binary_linux_build

  binary_linux_manywheel_2.7mu_cu90_build:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7mu cu90"
    docker:
      - image: "soumith/manylinux-cuda90"
    <<: *binary_linux_build

  binary_linux_manywheel_3.5m_cu90_build:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.5m cu90"
    docker:
      - image: "soumith/manylinux-cuda90"
    <<: *binary_linux_build

  binary_linux_manywheel_3.6m_cu90_build:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.6m cu90"
    docker:
      - image: "soumith/manylinux-cuda90"
    <<: *binary_linux_build

  binary_linux_manywheel_3.7m_cu90_build:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.7m cu90"
    docker:
      - image: "soumith/manylinux-cuda90"
    <<: *binary_linux_build

  binary_linux_manywheel_2.7m_cu100_build:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7m cu100"
    docker:
      - image: "soumith/manylinux-cuda100"
    <<: *binary_linux_build

  binary_linux_manywheel_2.7mu_cu100_build:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7mu cu100"
    docker:
      - image: "soumith/manylinux-cuda100"
    <<: *binary_linux_build

  binary_linux_manywheel_3.5m_cu100_build:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.5m cu100"
    docker:
      - image: "soumith/manylinux-cuda100"
    <<: *binary_linux_build

  binary_linux_manywheel_3.6m_cu100_build:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.6m cu100"
    docker:
      - image: "soumith/manylinux-cuda100"
    <<: *binary_linux_build

  binary_linux_manywheel_3.7m_cu100_build:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.7m cu100"
    docker:
      - image: "soumith/manylinux-cuda100"
    <<: *binary_linux_build

  binary_linux_conda_2.7_cpu_build:
    environment:
      BUILD_ENVIRONMENT: "conda 2.7 cpu"
    docker:
      - image: "soumith/conda-cuda"
    <<: *binary_linux_build

  binary_linux_conda_3.5_cpu_build:
    environment:
      BUILD_ENVIRONMENT: "conda 3.5 cpu"
    docker:
      - image: "soumith/conda-cuda"
    <<: *binary_linux_build

  binary_linux_conda_3.6_cpu_build:
    environment:
      BUILD_ENVIRONMENT: "conda 3.6 cpu"
    docker:
      - image: "soumith/conda-cuda"
    <<: *binary_linux_build

  binary_linux_conda_3.7_cpu_build:
    environment:
      BUILD_ENVIRONMENT: "conda 3.7 cpu"
    docker:
      - image: "soumith/conda-cuda"
    <<: *binary_linux_build

  binary_linux_conda_2.7_cu80_build:
    environment:
      BUILD_ENVIRONMENT: "conda 2.7 cu80"
    docker:
      - image: "soumith/conda-cuda"
    <<: *binary_linux_build

  binary_linux_conda_3.5_cu80_build:
    environment:
      BUILD_ENVIRONMENT: "conda 3.5 cu80"
    docker:
      - image: "soumith/conda-cuda"
    <<: *binary_linux_build

  binary_linux_conda_3.6_cu80_build:
    environment:
      BUILD_ENVIRONMENT: "conda 3.6 cu80"
    docker:
      - image: "soumith/conda-cuda"
    <<: *binary_linux_build

  binary_linux_conda_3.7_cu80_build:
    environment:
      BUILD_ENVIRONMENT: "conda 3.7 cu80"
    docker:
      - image: "soumith/conda-cuda"
    <<: *binary_linux_build

  binary_linux_conda_2.7_cu90_build:
    environment:
      BUILD_ENVIRONMENT: "conda 2.7 cu90"
    docker:
      - image: "soumith/conda-cuda"
    <<: *binary_linux_build

  binary_linux_conda_3.5_cu90_build:
    environment:
      BUILD_ENVIRONMENT: "conda 3.5 cu90"
    docker:
      - image: "soumith/conda-cuda"
    <<: *binary_linux_build

  binary_linux_conda_3.6_cu90_build:
    environment:
      BUILD_ENVIRONMENT: "conda 3.6 cu90"
    docker:
      - image: "soumith/conda-cuda"
    <<: *binary_linux_build

  binary_linux_conda_3.7_cu90_build:
    environment:
      BUILD_ENVIRONMENT: "conda 3.7 cu90"
    docker:
      - image: "soumith/conda-cuda"
    <<: *binary_linux_build

  binary_linux_conda_2.7_cu100_build:
    environment:
      BUILD_ENVIRONMENT: "conda 2.7 cu100"
    docker:
      - image: "soumith/conda-cuda"
    <<: *binary_linux_build

  binary_linux_conda_3.5_cu100_build:
    environment:
      BUILD_ENVIRONMENT: "conda 3.5 cu100"
    docker:
      - image: "soumith/conda-cuda"
    <<: *binary_linux_build

  binary_linux_conda_3.6_cu100_build:
    environment:
      BUILD_ENVIRONMENT: "conda 3.6 cu100"
    docker:
      - image: "soumith/conda-cuda"
    <<: *binary_linux_build

  binary_linux_conda_3.7_cu100_build:
    environment:
      BUILD_ENVIRONMENT: "conda 3.7 cu100"
    docker:
      - image: "soumith/conda-cuda"
    <<: *binary_linux_build

  binary_linux_libtorch_2.7m_cpu_build:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cpu"
    docker:
      - image: "soumith/manylinux-cuda80"
    <<: *binary_linux_build

  binary_linux_libtorch_2.7m_cu80_build:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cu80"
    docker:
      - image: "soumith/manylinux-cuda80"
    <<: *binary_linux_build

  binary_linux_libtorch_2.7m_cu90_build:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cu90"
    docker:
      - image: "soumith/manylinux-cuda90"
    <<: *binary_linux_build

  binary_linux_libtorch_2.7m_cu100_build:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cu100"
    docker:
      - image: "soumith/manylinux-cuda100"
    <<: *binary_linux_build

  binary_macos_wheel_2.7_cpu_build:
    environment:
      BUILD_ENVIRONMENT: "wheel 2.7 cpu"
    <<: *binary_mac_build

  binary_macos_wheel_3.5_cpu_build:
    environment:
      BUILD_ENVIRONMENT: "wheel 3.5 cpu"
    <<: *binary_mac_build

  binary_macos_wheel_3.6_cpu_build:
    environment:
      BUILD_ENVIRONMENT: "wheel 3.6 cpu"
    <<: *binary_mac_build

  binary_macos_wheel_3.7_cpu_build:
    environment:
      BUILD_ENVIRONMENT: "wheel 3.7 cpu"
    <<: *binary_mac_build

  binary_macos_conda_2.7_cpu_build:
    environment:
      BUILD_ENVIRONMENT: "conda 2.7 cpu"
    <<: *binary_mac_build

  binary_macos_conda_3.5_cpu_build:
    environment:
      BUILD_ENVIRONMENT: "conda 3.5 cpu"
    <<: *binary_mac_build

  binary_macos_conda_3.6_cpu_build:
    environment:
      BUILD_ENVIRONMENT: "conda 3.6 cpu"
    <<: *binary_mac_build

  binary_macos_conda_3.7_cpu_build:
    environment:
      BUILD_ENVIRONMENT: "conda 3.7 cpu"
    <<: *binary_mac_build

  binary_macos_libtorch_2.7_cpu_build:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7 cpu"
    <<: *binary_mac_build

  # Binary build tests
  # These are the smoke tests run right after the build, before the upload. If
  # these fail, the upload doesn't happen
  #############################################################################
  binary_linux_manywheel_2.7m_cpu_test:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7m cpu"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
    <<: *binary_linux_test

  binary_linux_manywheel_2.7mu_cpu_test:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7mu cpu"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
    <<: *binary_linux_test

  binary_linux_manywheel_3.5m_cpu_test:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.5m cpu"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
    <<: *binary_linux_test

  binary_linux_manywheel_3.6m_cpu_test:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.6m cpu"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
    <<: *binary_linux_test

  binary_linux_manywheel_3.7m_cpu_test:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.7m cpu"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
    <<: *binary_linux_test

  binary_linux_manywheel_2.7m_cu80_test:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7m cu80"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_manywheel_2.7mu_cu80_test:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7mu cu80"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_manywheel_3.5m_cu80_test:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.5m cu80"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_manywheel_3.6m_cu80_test:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.6m cu80"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_manywheel_3.7m_cu80_test:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.7m cu80"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_manywheel_2.7m_cu90_test:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7m cu90"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/manylinux-cuda90"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_manywheel_2.7mu_cu90_test:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7mu cu90"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/manylinux-cuda90"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_manywheel_3.5m_cu90_test:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.5m cu90"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/manylinux-cuda90"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_manywheel_3.6m_cu90_test:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.6m cu90"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/manylinux-cuda90"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_manywheel_3.7m_cu90_test:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.7m cu90"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/manylinux-cuda90"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_manywheel_2.7m_cu100_test:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7m cu100"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/manylinux-cuda100"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_manywheel_2.7mu_cu100_test:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7mu cu100"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/manylinux-cuda100"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_manywheel_3.5m_cu100_test:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.5m cu100"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/manylinux-cuda100"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_manywheel_3.6m_cu100_test:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.6m cu100"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/manylinux-cuda100"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_manywheel_3.7m_cu100_test:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.7m cu100"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/manylinux-cuda100"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_conda_2.7_cpu_test:
    environment:
      BUILD_ENVIRONMENT: "conda 2.7 cpu"
      DOCKER_IMAGE: "soumith/conda-cuda"
    <<: *binary_linux_test

  binary_linux_conda_3.5_cpu_test:
    environment:
      BUILD_ENVIRONMENT: "conda 3.5 cpu"
      DOCKER_IMAGE: "soumith/conda-cuda"
    <<: *binary_linux_test

  binary_linux_conda_3.6_cpu_test:
    environment:
      BUILD_ENVIRONMENT: "conda 3.6 cpu"
      DOCKER_IMAGE: "soumith/conda-cuda"
    <<: *binary_linux_test

  binary_linux_conda_3.7_cpu_test:
    environment:
      BUILD_ENVIRONMENT: "conda 3.7 cpu"
      DOCKER_IMAGE: "soumith/conda-cuda"
    <<: *binary_linux_test

  binary_linux_conda_2.7_cu80_test:
    environment:
      BUILD_ENVIRONMENT: "conda 2.7 cu80"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/conda-cuda"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_conda_3.5_cu80_test:
    environment:
      BUILD_ENVIRONMENT: "conda 3.5 cu80"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/conda-cuda"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_conda_3.6_cu80_test:
    environment:
      BUILD_ENVIRONMENT: "conda 3.6 cu80"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/conda-cuda"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_conda_3.7_cu80_test:
    environment:
      BUILD_ENVIRONMENT: "conda 3.7 cu80"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/conda-cuda"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_conda_2.7_cu90_test:
    environment:
      BUILD_ENVIRONMENT: "conda 2.7 cu90"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/conda-cuda"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_conda_3.5_cu90_test:
    environment:
      BUILD_ENVIRONMENT: "conda 3.5 cu90"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/conda-cuda"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_conda_3.6_cu90_test:
    environment:
      BUILD_ENVIRONMENT: "conda 3.6 cu90"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/conda-cuda"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_conda_3.7_cu90_test:
    environment:
      BUILD_ENVIRONMENT: "conda 3.7 cu90"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/conda-cuda"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_conda_2.7_cu100_test:
    environment:
      BUILD_ENVIRONMENT: "conda 2.7 cu100"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/conda-cuda"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_conda_3.5_cu100_test:
    environment:
      BUILD_ENVIRONMENT: "conda 3.5 cu100"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/conda-cuda"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_conda_3.6_cu100_test:
    environment:
      BUILD_ENVIRONMENT: "conda 3.6 cu100"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/conda-cuda"
    resource_class: gpu.medium
    <<: *binary_linux_test

  binary_linux_conda_3.7_cu100_test:
    environment:
      BUILD_ENVIRONMENT: "conda 3.7 cu100"
      USE_CUDA_DOCKER_RUNTIME: "1"
      DOCKER_IMAGE: "soumith/conda-cuda"
    resource_class: gpu.medium
    <<: *binary_linux_test

# There is currently no testing for libtorch TODO
#  binary_linux_libtorch_2.7m_cpu_test:
#    environment:
#      BUILD_ENVIRONMENT: "libtorch 2.7m cpu"
#    resource_class: gpu.medium
#    <<: *binary_linux_test
#
#  binary_linux_libtorch_2.7m_cu80_test:
#    environment:
#      BUILD_ENVIRONMENT: "libtorch 2.7m cu80"
#    resource_class: gpu.medium
#    <<: *binary_linux_test
#
#  binary_linux_libtorch_2.7m_cu90_test:
#    environment:
#      BUILD_ENVIRONMENT: "libtorch 2.7m cu90"
#    resource_class: gpu.medium
#    <<: *binary_linux_test
#
#  binary_linux_libtorch_2.7m_cu100_test:
#    environment:
#      BUILD_ENVIRONMENT: "libtorch 2.7m cu100"
#    resource_class: gpu.medium
#    <<: *binary_linux_test

  # Binary build uploads
  #############################################################################
  binary_linux_manywheel_2.7m_cpu_upload:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7m cpu"
    <<: *binary_linux_upload

  binary_linux_manywheel_2.7mu_cpu_upload:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7mu cpu"
    <<: *binary_linux_upload

  binary_linux_manywheel_3.5m_cpu_upload:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.5m cpu"
    <<: *binary_linux_upload

  binary_linux_manywheel_3.6m_cpu_upload:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.6m cpu"
    <<: *binary_linux_upload

  binary_linux_manywheel_3.7m_cpu_upload:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.7m cpu"
    <<: *binary_linux_upload

  binary_linux_manywheel_2.7m_cu80_upload:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7m cu80"
    <<: *binary_linux_upload

  binary_linux_manywheel_2.7mu_cu80_upload:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7mu cu80"
    <<: *binary_linux_upload

  binary_linux_manywheel_3.5m_cu80_upload:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.5m cu80"
    <<: *binary_linux_upload

  binary_linux_manywheel_3.6m_cu80_upload:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.6m cu80"
    <<: *binary_linux_upload

  binary_linux_manywheel_3.7m_cu80_upload:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.7m cu80"
    <<: *binary_linux_upload

  binary_linux_manywheel_2.7m_cu90_upload:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7m cu90"
    <<: *binary_linux_upload

  binary_linux_manywheel_2.7mu_cu90_upload:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7mu cu90"
    <<: *binary_linux_upload

  binary_linux_manywheel_3.5m_cu90_upload:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.5m cu90"
    <<: *binary_linux_upload

  binary_linux_manywheel_3.6m_cu90_upload:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.6m cu90"
    <<: *binary_linux_upload

  binary_linux_manywheel_3.7m_cu90_upload:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.7m cu90"
    <<: *binary_linux_upload

  binary_linux_manywheel_2.7m_cu100_upload:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7m cu100"
    <<: *binary_linux_upload

  binary_linux_manywheel_2.7mu_cu100_upload:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7mu cu100"
    <<: *binary_linux_upload

  binary_linux_manywheel_3.5m_cu100_upload:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.5m cu100"
    <<: *binary_linux_upload

  binary_linux_manywheel_3.6m_cu100_upload:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.6m cu100"
    <<: *binary_linux_upload

  binary_linux_manywheel_3.7m_cu100_upload:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.7m cu100"
    <<: *binary_linux_upload

  binary_linux_conda_2.7_cpu_upload:
    environment:
      BUILD_ENVIRONMENT: "conda 2.7 cpu"
    <<: *binary_linux_upload

  binary_linux_conda_3.5_cpu_upload:
    environment:
      BUILD_ENVIRONMENT: "conda 3.5 cpu"
    <<: *binary_linux_upload

  binary_linux_conda_3.6_cpu_upload:
    environment:
      BUILD_ENVIRONMENT: "conda 3.6 cpu"
    <<: *binary_linux_upload

  binary_linux_conda_3.7_cpu_upload:
    environment:
      BUILD_ENVIRONMENT: "conda 3.7 cpu"
    <<: *binary_linux_upload

  binary_linux_conda_2.7_cu80_upload:
    environment:
      BUILD_ENVIRONMENT: "conda 2.7 cu80"
    <<: *binary_linux_upload

  binary_linux_conda_3.5_cu80_upload:
    environment:
      BUILD_ENVIRONMENT: "conda 3.5 cu80"
    <<: *binary_linux_upload

  binary_linux_conda_3.6_cu80_upload:
    environment:
      BUILD_ENVIRONMENT: "conda 3.6 cu80"
    <<: *binary_linux_upload

  binary_linux_conda_3.7_cu80_upload:
    environment:
      BUILD_ENVIRONMENT: "conda 3.7 cu80"
    <<: *binary_linux_upload

  binary_linux_conda_2.7_cu90_upload:
    environment:
      BUILD_ENVIRONMENT: "conda 2.7 cu90"
    <<: *binary_linux_upload

  binary_linux_conda_3.5_cu90_upload:
    environment:
      BUILD_ENVIRONMENT: "conda 3.5 cu90"
    <<: *binary_linux_upload

  binary_linux_conda_3.6_cu90_upload:
    environment:
      BUILD_ENVIRONMENT: "conda 3.6 cu90"
    <<: *binary_linux_upload

  binary_linux_conda_3.7_cu90_upload:
    environment:
      BUILD_ENVIRONMENT: "conda 3.7 cu90"
    <<: *binary_linux_upload

  binary_linux_conda_2.7_cu100_upload:
    environment:
      BUILD_ENVIRONMENT: "conda 2.7 cu100"
    <<: *binary_linux_upload

  binary_linux_conda_3.5_cu100_upload:
    environment:
      BUILD_ENVIRONMENT: "conda 3.5 cu100"
    <<: *binary_linux_upload

  binary_linux_conda_3.6_cu100_upload:
    environment:
      BUILD_ENVIRONMENT: "conda 3.6 cu100"
    <<: *binary_linux_upload

  binary_linux_conda_3.7_cu100_upload:
    environment:
      BUILD_ENVIRONMENT: "conda 3.7 cu100"
    <<: *binary_linux_upload

  binary_linux_libtorch_2.7m_cpu_upload:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cpu"
    <<: *binary_linux_upload

  binary_linux_libtorch_2.7m_cu80_upload:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cu80"
    <<: *binary_linux_upload

  binary_linux_libtorch_2.7m_cu90_upload:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cu90"
    <<: *binary_linux_upload

  binary_linux_libtorch_2.7m_cu100_upload:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cu100"
    <<: *binary_linux_upload

  binary_macos_wheel_2.7_cpu_upload:
    environment:
      BUILD_ENVIRONMENT: "wheel 2.7 cpu"
    <<: *binary_mac_upload

  binary_macos_wheel_3.5_cpu_upload:
    environment:
      BUILD_ENVIRONMENT: "wheel 3.5 cpu"
    <<: *binary_mac_upload

  binary_macos_wheel_3.6_cpu_upload:
    environment:
      BUILD_ENVIRONMENT: "wheel 3.6 cpu"
    <<: *binary_mac_upload

  binary_macos_wheel_3.7_cpu_upload:
    environment:
      BUILD_ENVIRONMENT: "wheel 3.7 cpu"
    <<: *binary_mac_upload

  binary_macos_conda_2.7_cpu_upload:
    environment:
      BUILD_ENVIRONMENT: "conda 2.7 cpu"
    <<: *binary_mac_upload

  binary_macos_conda_3.5_cpu_upload:
    environment:
      BUILD_ENVIRONMENT: "conda 3.5 cpu"
    <<: *binary_mac_upload

  binary_macos_conda_3.6_cpu_upload:
    environment:
      BUILD_ENVIRONMENT: "conda 3.6 cpu"
    <<: *binary_mac_upload

  binary_macos_conda_3.7_cpu_upload:
    environment:
      BUILD_ENVIRONMENT: "conda 3.7 cpu"
    <<: *binary_mac_upload

  binary_macos_libtorch_2.7_cpu_upload:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7 cpu"
    <<: *binary_mac_upload


##############################################################################
# Smoke test specs individual job specifications
##############################################################################
  smoke_linux_manywheel_2.7m_cpu:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7m cpu"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
    <<: *smoke_linux_test

  smoke_linux_manywheel_2.7mu_cpu:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7mu cpu"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
    <<: *smoke_linux_test

  smoke_linux_manywheel_3.5m_cpu:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.5m cpu"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
    <<: *smoke_linux_test

  smoke_linux_manywheel_3.6m_cpu:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.6m cpu"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
    <<: *smoke_linux_test

  smoke_linux_manywheel_3.7m_cpu:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.7m cpu"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
    <<: *smoke_linux_test

  smoke_linux_manywheel_2.7m_cu80:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7m cu80"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_manywheel_2.7mu_cu80:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7mu cu80"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_manywheel_3.5m_cu80:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.5m cu80"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_manywheel_3.6m_cu80:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.6m cu80"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_manywheel_3.7m_cu80:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.7m cu80"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_manywheel_2.7m_cu90:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7m cu90"
      DOCKER_IMAGE: "soumith/manylinux-cuda90"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_manywheel_2.7mu_cu90:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7mu cu90"
      DOCKER_IMAGE: "soumith/manylinux-cuda90"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_manywheel_3.5m_cu90:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.5m cu90"
      DOCKER_IMAGE: "soumith/manylinux-cuda90"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_manywheel_3.6m_cu90:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.6m cu90"
      DOCKER_IMAGE: "soumith/manylinux-cuda90"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_manywheel_3.7m_cu90:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.7m cu90"
      DOCKER_IMAGE: "soumith/manylinux-cuda90"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_manywheel_2.7m_cu100:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7m cu100"
      DOCKER_IMAGE: "soumith/manylinux-cuda100"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_manywheel_2.7mu_cu100:
    environment:
      BUILD_ENVIRONMENT: "manywheel 2.7mu cu100"
      DOCKER_IMAGE: "soumith/manylinux-cuda100"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_manywheel_3.5m_cu100:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.5m cu100"
      DOCKER_IMAGE: "soumith/manylinux-cuda100"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_manywheel_3.6m_cu100:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.6m cu100"
      DOCKER_IMAGE: "soumith/manylinux-cuda100"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_manywheel_3.7m_cu100:
    environment:
      BUILD_ENVIRONMENT: "manywheel 3.7m cu100"
      DOCKER_IMAGE: "soumith/manylinux-cuda100"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_conda_2.7_cpu:
    environment:
      BUILD_ENVIRONMENT: "conda 2.7 cpu"
      DOCKER_IMAGE: "soumith/conda-cuda"
    <<: *smoke_linux_test

  smoke_linux_conda_3.5_cpu:
    environment:
      BUILD_ENVIRONMENT: "conda 3.5 cpu"
      DOCKER_IMAGE: "soumith/conda-cuda"
    <<: *smoke_linux_test

  smoke_linux_conda_3.6_cpu:
    environment:
      BUILD_ENVIRONMENT: "conda 3.6 cpu"
      DOCKER_IMAGE: "soumith/conda-cuda"
    <<: *smoke_linux_test

  smoke_linux_conda_3.7_cpu:
    environment:
      BUILD_ENVIRONMENT: "conda 3.7 cpu"
      DOCKER_IMAGE: "soumith/conda-cuda"
    <<: *smoke_linux_test

  smoke_linux_conda_2.7_cu80:
    environment:
      BUILD_ENVIRONMENT: "conda 2.7 cu80"
      DOCKER_IMAGE: "soumith/conda-cuda"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_conda_3.5_cu80:
    environment:
      BUILD_ENVIRONMENT: "conda 3.5 cu80"
      DOCKER_IMAGE: "soumith/conda-cuda"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_conda_3.6_cu80:
    environment:
      BUILD_ENVIRONMENT: "conda 3.6 cu80"
      DOCKER_IMAGE: "soumith/conda-cuda"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_conda_3.7_cu80:
    environment:
      BUILD_ENVIRONMENT: "conda 3.7 cu80"
      DOCKER_IMAGE: "soumith/conda-cuda"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_conda_2.7_cu90:
    environment:
      BUILD_ENVIRONMENT: "conda 2.7 cu90"
      DOCKER_IMAGE: "soumith/conda-cuda"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_conda_3.5_cu90:
    environment:
      BUILD_ENVIRONMENT: "conda 3.5 cu90"
      DOCKER_IMAGE: "soumith/conda-cuda"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_conda_3.6_cu90:
    environment:
      BUILD_ENVIRONMENT: "conda 3.6 cu90"
      DOCKER_IMAGE: "soumith/conda-cuda"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_conda_3.7_cu90:
    environment:
      BUILD_ENVIRONMENT: "conda 3.7 cu90"
      DOCKER_IMAGE: "soumith/conda-cuda"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_conda_2.7_cu100:
    environment:
      BUILD_ENVIRONMENT: "conda 2.7 cu100"
      DOCKER_IMAGE: "soumith/conda-cuda"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_conda_3.5_cu100:
    environment:
      BUILD_ENVIRONMENT: "conda 3.5 cu100"
      DOCKER_IMAGE: "soumith/conda-cuda"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_conda_3.6_cu100:
    environment:
      BUILD_ENVIRONMENT: "conda 3.6 cu100"
      DOCKER_IMAGE: "soumith/conda-cuda"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_conda_3.7_cu100:
    environment:
      BUILD_ENVIRONMENT: "conda 3.7 cu100"
      DOCKER_IMAGE: "soumith/conda-cuda"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_libtorch_2.7m_cpu_shared-with-deps:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cpu"
      LIBTORCH_VARIANT: "shared-with-deps"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
    <<: *smoke_linux_test

  smoke_linux_libtorch_2.7m_cpu_shared-without-deps:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cpu"
      LIBTORCH_VARIANT: "shared-without-deps"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
    <<: *smoke_linux_test

  smoke_linux_libtorch_2.7m_cpu_static-with-deps:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cpu"
      LIBTORCH_VARIANT: "static-with-deps"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
    <<: *smoke_linux_test

  smoke_linux_libtorch_2.7m_cpu_static-without-deps:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cpu"
      LIBTORCH_VARIANT: "static-without-deps"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
    <<: *smoke_linux_test

  smoke_linux_libtorch_2.7m_cu80_shared-with-deps:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cu80"
      LIBTORCH_VARIANT: "shared-with-deps"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_libtorch_2.7m_cu80_shared-without-deps:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cu80"
      LIBTORCH_VARIANT: "shared-without-deps"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_libtorch_2.7m_cu80_static-with-deps:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cu80"
      LIBTORCH_VARIANT: "static-with-deps"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_libtorch_2.7m_cu80_static-without-deps:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cu80"
      LIBTORCH_VARIANT: "static-without-deps"
      DOCKER_IMAGE: "soumith/manylinux-cuda80"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_libtorch_2.7m_cu90_shared-with-deps:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cu90"
      LIBTORCH_VARIANT: "shared-with-deps"
      DOCKER_IMAGE: "soumith/manylinux-cuda90"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_libtorch_2.7m_cu90_shared-without-deps:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cu90"
      LIBTORCH_VARIANT: "shared-without-deps"
      DOCKER_IMAGE: "soumith/manylinux-cuda90"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_libtorch_2.7m_cu90_static-with-deps:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cu90"
      LIBTORCH_VARIANT: "static-with-deps"
      DOCKER_IMAGE: "soumith/manylinux-cuda90"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_libtorch_2.7m_cu90_static-without-deps:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cu90"
      LIBTORCH_VARIANT: "static-without-deps"
      DOCKER_IMAGE: "soumith/manylinux-cuda90"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_libtorch_2.7m_cu100_shared-with-deps:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cu100"
      LIBTORCH_VARIANT: "shared-with-deps"
      DOCKER_IMAGE: "soumith/manylinux-cuda100"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_libtorch_2.7m_cu100_shared-without-deps:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cu100"
      LIBTORCH_VARIANT: "shared-without-deps"
      DOCKER_IMAGE: "soumith/manylinux-cuda100"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_libtorch_2.7m_cu100_static-with-deps:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cu100"
      LIBTORCH_VARIANT: "static-with-deps"
      DOCKER_IMAGE: "soumith/manylinux-cuda100"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_linux_libtorch_2.7m_cu100_static-without-deps:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cu100"
      LIBTORCH_VARIANT: "static-without-deps"
      DOCKER_IMAGE: "soumith/manylinux-cuda100"
      USE_CUDA_DOCKER_RUNTIME: "1"
    resource_class: gpu.medium
    <<: *smoke_linux_test

  smoke_macos_wheel_2.7_cpu:
    environment:
      BUILD_ENVIRONMENT: "wheel 2.7 cpu"
    <<: *smoke_mac_test

  smoke_macos_wheel_3.5_cpu:
    environment:
      BUILD_ENVIRONMENT: "wheel 3.5 cpu"
    <<: *smoke_mac_test

  smoke_macos_wheel_3.6_cpu:
    environment:
      BUILD_ENVIRONMENT: "wheel 3.6 cpu"
    <<: *smoke_mac_test

  smoke_macos_wheel_3.7_cpu:
    environment:
      BUILD_ENVIRONMENT: "wheel 3.7 cpu"
    <<: *smoke_mac_test

  smoke_macos_conda_2.7_cpu:
    environment:
      BUILD_ENVIRONMENT: "conda 2.7 cpu"
    <<: *smoke_mac_test

  smoke_macos_conda_3.5_cpu:
    environment:
      BUILD_ENVIRONMENT: "conda 3.5 cpu"
    <<: *smoke_mac_test

  smoke_macos_conda_3.6_cpu:
    environment:
      BUILD_ENVIRONMENT: "conda 3.6 cpu"
    <<: *smoke_mac_test

  smoke_macos_conda_3.7_cpu:
    environment:
      BUILD_ENVIRONMENT: "conda 3.7 cpu"
    <<: *smoke_mac_test

  smoke_macos_libtorch_2.7_cpu:
    environment:
      BUILD_ENVIRONMENT: "libtorch 2.7m cpu"
    <<: *smoke_mac_test


##############################################################################
##############################################################################
# Workflows
##############################################################################
##############################################################################

# PR jobs pr builds
workflows:
  version: 2
  build:
    jobs:
      # Pytorch linux builds
      - pytorch_linux_trusty_py2_7_9_build
      - pytorch_linux_trusty_py2_7_9_test:
          requires:
            - pytorch_linux_trusty_py2_7_9_build
      - pytorch_linux_trusty_py2_7_build
      - pytorch_linux_trusty_py2_7_test:
          requires:
            - pytorch_linux_trusty_py2_7_build
      - pytorch_linux_trusty_py3_5_build
      - pytorch_linux_trusty_py3_5_test:
          requires:
            - pytorch_linux_trusty_py3_5_build
      - pytorch_linux_trusty_py3_6_gcc4_8_build
      - pytorch_linux_trusty_py3_6_gcc4_8_test:
          requires:
            - pytorch_linux_trusty_py3_6_gcc4_8_build
      - pytorch_linux_trusty_py3_6_gcc5_4_build
      - pytorch_linux_trusty_py3_6_gcc5_4_test:
          requires:
            - pytorch_linux_trusty_py3_6_gcc5_4_build
      - pytorch_linux_trusty_py3_6_gcc7_build
      - pytorch_linux_trusty_py3_6_gcc7_test:
          requires:
            - pytorch_linux_trusty_py3_6_gcc7_build
      - pytorch_xla_linux_trusty_py3_6_gcc5_4_build:
          filters:
            branches:
              only:
                - master
      - pytorch_xla_linux_trusty_py3_6_gcc5_4_test:
          filters:
            branches:
              only:
                - master
          requires:
            - pytorch_xla_linux_trusty_py3_6_gcc5_4_build
      - pytorch_linux_trusty_pynightly_build
      - pytorch_linux_trusty_pynightly_test:
          requires:
            - pytorch_linux_trusty_pynightly_build
      - pytorch_linux_xenial_py3_clang5_asan_build
      - pytorch_linux_xenial_py3_clang5_asan_test:
          requires:
            - pytorch_linux_xenial_py3_clang5_asan_build
      - pytorch_linux_xenial_cuda8_cudnn7_py3_build
      - pytorch_linux_xenial_cuda8_cudnn7_py3_test:
          requires:
            - pytorch_linux_xenial_cuda8_cudnn7_py3_build
      - pytorch_linux_xenial_cuda8_cudnn7_py3_multigpu_test:
          requires:
            - pytorch_linux_xenial_cuda8_cudnn7_py3_build
      - pytorch_linux_xenial_cuda8_cudnn7_py3_NO_AVX2_test:
          requires:
            - pytorch_linux_xenial_cuda8_cudnn7_py3_build
      - pytorch_linux_xenial_cuda8_cudnn7_py3_NO_AVX_NO_AVX2_test:
          requires:
            - pytorch_linux_xenial_cuda8_cudnn7_py3_build
      - pytorch_short_perf_test_gpu:
          requires:
            - pytorch_linux_xenial_cuda8_cudnn7_py3_build
      - pytorch_doc_push:
          requires:
            - pytorch_linux_xenial_cuda8_cudnn7_py3_build
      - pytorch_linux_xenial_cuda9_cudnn7_py2_build
      - pytorch_linux_xenial_cuda9_cudnn7_py2_test:
          requires:
            - pytorch_linux_xenial_cuda9_cudnn7_py2_build
      - pytorch_linux_xenial_cuda9_cudnn7_py3_build
      - pytorch_linux_xenial_cuda9_cudnn7_py3_test:
          requires:
            - pytorch_linux_xenial_cuda9_cudnn7_py3_build
      - pytorch_linux_xenial_cuda9_2_cudnn7_py3_gcc7_build
      - pytorch_linux_xenial_cuda9_2_cudnn7_py3_gcc7_test:
          requires:
            - pytorch_linux_xenial_cuda9_2_cudnn7_py3_gcc7_build
      - pytorch_linux_xenial_cuda10_cudnn7_py3_gcc7_build

      # Pytorch MacOS builds
      - pytorch_macos_10_13_py3_build
      - pytorch_macos_10_13_py3_test:
          requires:
            - pytorch_macos_10_13_py3_build
      - pytorch_macos_10_13_cuda9_2_cudnn7_py3_build

      # Caffe2 builds
      - caffe2_cmake_cuda9_0_cudnn7_ubuntu16_04_build
      - caffe2_cmake_cuda9_0_cudnn7_ubuntu16_04_test:
          requires:
            - caffe2_cmake_cuda9_0_cudnn7_ubuntu16_04_build
      - caffe2_py2_cuda9_0_cudnn7_ubuntu16_04_build
      - caffe2_py2_cuda9_0_cudnn7_ubuntu16_04_test:
          requires:
            - caffe2_py2_cuda9_0_cudnn7_ubuntu16_04_build
      - caffe2_py2_cuda9_1_cudnn7_ubuntu16_04_build
      - caffe2_py2_cuda9_1_cudnn7_ubuntu16_04_test:
          requires:
            - caffe2_py2_cuda9_1_cudnn7_ubuntu16_04_build
      - caffe2_py2_mkl_ubuntu16_04_build
      - caffe2_py2_mkl_ubuntu16_04_test:
          requires:
            - caffe2_py2_mkl_ubuntu16_04_build
      - caffe2_py2_gcc4_8_ubuntu14_04_build
      - caffe2_py2_gcc4_8_ubuntu14_04_test:
          requires:
            - caffe2_py2_gcc4_8_ubuntu14_04_build
      - caffe2_onnx_py2_gcc5_ubuntu16_04_build
      - caffe2_onnx_py2_gcc5_ubuntu16_04_test:
          requires:
            - caffe2_onnx_py2_gcc5_ubuntu16_04_build
      - caffe2_py2_cuda8_0_cudnn7_ubuntu16_04_build
      - caffe2_py2_cuda8_0_cudnn7_ubuntu16_04_test:
          requires:
            - caffe2_py2_cuda8_0_cudnn7_ubuntu16_04_build
      - caffe2_py2_clang3_8_ubuntu16_04_build
      - caffe2_py2_clang3_9_ubuntu16_04_build
      - caffe2_py2_clang7_ubuntu16_04_build
      - caffe2_py2_android_ubuntu16_04_build
      - caffe2_py2_cuda9_0_cudnn7_centos7_build
      - caffe2_py2_cuda9_0_cudnn7_centos7_test:
          requires:
            - caffe2_py2_cuda9_0_cudnn7_centos7_build

      # Caffe2 MacOS builds
      - caffe2_py2_ios_macos10_13_build
      - caffe2_py2_system_macos10_13_build

      # Binary builds (subset, to smoke test that they'll work)
      - binary_linux_manywheel_2.7mu_cpu_build
      - binary_linux_manywheel_3.7m_cu100_build
      - binary_linux_conda_2.7_cpu_build
      # This binary build is currently broken, see https://github.com/pytorch/pytorch/issues/16710
      # - binary_linux_conda_3.6_cu90_build
      - binary_linux_libtorch_2.7m_cu80_build
      - binary_macos_wheel_3.6_cpu_build
      - binary_macos_conda_2.7_cpu_build
      - binary_macos_libtorch_2.7_cpu_build

      - binary_linux_manywheel_2.7mu_cpu_test:
          requires:
            - binary_linux_manywheel_2.7mu_cpu_build
      - binary_linux_manywheel_3.7m_cu100_test:
          requires:
            - binary_linux_manywheel_3.7m_cu100_build
      - binary_linux_conda_2.7_cpu_test:
          requires:
            - binary_linux_conda_2.7_cpu_build
      # This binary build is currently broken, see https://github.com/pytorch/pytorch/issues/16710
      # - binary_linux_conda_3.6_cu90_test:
      #     requires:
      #       - binary_linux_conda_3.6_cu90_build

##############################################################################
# Daily smoke test trigger
##############################################################################
  binarysmoketests:
    triggers:
      - schedule:
          cron: "15 16 * * *"
          filters:
            branches:
              only:
                - master
    jobs:
      - smoke_linux_manywheel_2.7m_cpu
      - smoke_linux_manywheel_2.7mu_cpu
      - smoke_linux_manywheel_3.5m_cpu
      - smoke_linux_manywheel_3.6m_cpu
      - smoke_linux_manywheel_3.7m_cpu
      - smoke_linux_manywheel_2.7m_cu80
      - smoke_linux_manywheel_2.7mu_cu80
      - smoke_linux_manywheel_3.5m_cu80
      - smoke_linux_manywheel_3.6m_cu80
      - smoke_linux_manywheel_3.7m_cu80
      - smoke_linux_manywheel_2.7m_cu90
      - smoke_linux_manywheel_2.7mu_cu90
      - smoke_linux_manywheel_3.5m_cu90
      - smoke_linux_manywheel_3.6m_cu90
      - smoke_linux_manywheel_3.7m_cu90
      - smoke_linux_manywheel_2.7m_cu100
      - smoke_linux_manywheel_2.7mu_cu100
      - smoke_linux_manywheel_3.5m_cu100
      - smoke_linux_manywheel_3.6m_cu100
      - smoke_linux_manywheel_3.7m_cu100
      - smoke_linux_conda_2.7_cpu
      - smoke_linux_conda_3.5_cpu
      - smoke_linux_conda_3.6_cpu
      - smoke_linux_conda_3.7_cpu
      - smoke_linux_conda_2.7_cu80
      - smoke_linux_conda_3.5_cu80
      - smoke_linux_conda_3.6_cu80
      - smoke_linux_conda_3.7_cu80
      - smoke_linux_conda_2.7_cu90
      - smoke_linux_conda_3.5_cu90
      - smoke_linux_conda_3.6_cu90
      - smoke_linux_conda_3.7_cu90
      - smoke_linux_conda_2.7_cu100
      - smoke_linux_conda_3.5_cu100
      - smoke_linux_conda_3.6_cu100
      - smoke_linux_conda_3.7_cu100
      - smoke_linux_libtorch_2.7m_cpu_shared-with-deps
      - smoke_linux_libtorch_2.7m_cpu_shared-without-deps
      - smoke_linux_libtorch_2.7m_cpu_static-with-deps
      - smoke_linux_libtorch_2.7m_cpu_static-without-deps
      - smoke_linux_libtorch_2.7m_cu80_shared-with-deps
      - smoke_linux_libtorch_2.7m_cu80_shared-without-deps
      - smoke_linux_libtorch_2.7m_cu80_static-with-deps
      - smoke_linux_libtorch_2.7m_cu80_static-without-deps
      - smoke_linux_libtorch_2.7m_cu90_shared-with-deps
      - smoke_linux_libtorch_2.7m_cu90_shared-without-deps
      - smoke_linux_libtorch_2.7m_cu90_static-with-deps
      - smoke_linux_libtorch_2.7m_cu90_static-without-deps
      - smoke_linux_libtorch_2.7m_cu100_shared-with-deps
      - smoke_linux_libtorch_2.7m_cu100_shared-without-deps
      - smoke_linux_libtorch_2.7m_cu100_static-with-deps
      - smoke_linux_libtorch_2.7m_cu100_static-without-deps
      - smoke_macos_wheel_2.7_cpu
      - smoke_macos_wheel_3.5_cpu
      - smoke_macos_wheel_3.6_cpu
      - smoke_macos_wheel_3.7_cpu
      - smoke_macos_conda_2.7_cpu
      - smoke_macos_conda_3.5_cpu
      - smoke_macos_conda_3.6_cpu
      - smoke_macos_conda_3.7_cpu
      - smoke_macos_libtorch_2.7_cpu


##############################################################################
# Daily binary build trigger
##############################################################################
  binarybuilds:
    triggers:
      - schedule:
          cron: "5 5 * * *"
          filters:
            branches:
              only:
                - master
    jobs:
      - binary_linux_manywheel_2.7m_cpu_build
      - binary_linux_manywheel_2.7mu_cpu_build
      - binary_linux_manywheel_3.5m_cpu_build
      - binary_linux_manywheel_3.6m_cpu_build
      - binary_linux_manywheel_3.7m_cpu_build
      - binary_linux_manywheel_2.7m_cu80_build
      - binary_linux_manywheel_2.7mu_cu80_build
      - binary_linux_manywheel_3.5m_cu80_build
      - binary_linux_manywheel_3.6m_cu80_build
      - binary_linux_manywheel_3.7m_cu80_build
      - binary_linux_manywheel_2.7m_cu90_build
      - binary_linux_manywheel_2.7mu_cu90_build
      - binary_linux_manywheel_3.5m_cu90_build
      - binary_linux_manywheel_3.6m_cu90_build
      - binary_linux_manywheel_3.7m_cu90_build
      - binary_linux_manywheel_2.7m_cu100_build
      - binary_linux_manywheel_2.7mu_cu100_build
      - binary_linux_manywheel_3.5m_cu100_build
      - binary_linux_manywheel_3.6m_cu100_build
      - binary_linux_manywheel_3.7m_cu100_build
      - binary_linux_conda_2.7_cpu_build
      - binary_linux_conda_3.5_cpu_build
      - binary_linux_conda_3.6_cpu_build
      - binary_linux_conda_3.7_cpu_build
      - binary_linux_conda_2.7_cu80_build
      - binary_linux_conda_3.5_cu80_build
      - binary_linux_conda_3.6_cu80_build
      - binary_linux_conda_3.7_cu80_build
      - binary_linux_conda_2.7_cu90_build
      - binary_linux_conda_3.5_cu90_build
      - binary_linux_conda_3.6_cu90_build
      - binary_linux_conda_3.7_cu90_build
      - binary_linux_conda_2.7_cu100_build
      - binary_linux_conda_3.5_cu100_build
      - binary_linux_conda_3.6_cu100_build
      - binary_linux_conda_3.7_cu100_build
      - binary_linux_libtorch_2.7m_cpu_build
      - binary_linux_libtorch_2.7m_cu80_build
      - binary_linux_libtorch_2.7m_cu90_build
      - binary_linux_libtorch_2.7m_cu100_build
      - binary_macos_wheel_2.7_cpu_build
      - binary_macos_wheel_3.5_cpu_build
      - binary_macos_wheel_3.6_cpu_build
      - binary_macos_wheel_3.7_cpu_build
      - binary_macos_conda_2.7_cpu_build
      - binary_macos_conda_3.5_cpu_build
      - binary_macos_conda_3.6_cpu_build
      - binary_macos_conda_3.7_cpu_build
      - binary_macos_libtorch_2.7_cpu_build

      # Nightly tests
      - binary_linux_manywheel_2.7m_cpu_test:
          requires:
            - binary_linux_manywheel_2.7m_cpu_build
      - binary_linux_manywheel_2.7mu_cpu_test:
          requires:
            - binary_linux_manywheel_2.7mu_cpu_build
      - binary_linux_manywheel_3.5m_cpu_test:
          requires:
            - binary_linux_manywheel_3.5m_cpu_build
      - binary_linux_manywheel_3.6m_cpu_test:
          requires:
            - binary_linux_manywheel_3.6m_cpu_build
      - binary_linux_manywheel_3.7m_cpu_test:
          requires:
            - binary_linux_manywheel_3.7m_cpu_build
      - binary_linux_manywheel_2.7m_cu80_test:
          requires:
            - binary_linux_manywheel_2.7m_cu80_build
      - binary_linux_manywheel_2.7mu_cu80_test:
          requires:
            - binary_linux_manywheel_2.7mu_cu80_build
      - binary_linux_manywheel_3.5m_cu80_test:
          requires:
            - binary_linux_manywheel_3.5m_cu80_build
      - binary_linux_manywheel_3.6m_cu80_test:
          requires:
            - binary_linux_manywheel_3.6m_cu80_build
      - binary_linux_manywheel_3.7m_cu80_test:
          requires:
            - binary_linux_manywheel_3.7m_cu80_build
      - binary_linux_manywheel_2.7m_cu90_test:
          requires:
            - binary_linux_manywheel_2.7m_cu90_build
      - binary_linux_manywheel_2.7mu_cu90_test:
          requires:
            - binary_linux_manywheel_2.7mu_cu90_build
      - binary_linux_manywheel_3.5m_cu90_test:
          requires:
            - binary_linux_manywheel_3.5m_cu90_build
      - binary_linux_manywheel_3.6m_cu90_test:
          requires:
            - binary_linux_manywheel_3.6m_cu90_build
      - binary_linux_manywheel_3.7m_cu90_test:
          requires:
            - binary_linux_manywheel_3.7m_cu90_build
      - binary_linux_manywheel_2.7m_cu100_test:
          requires:
            - binary_linux_manywheel_2.7m_cu100_build
      - binary_linux_manywheel_2.7mu_cu100_test:
          requires:
            - binary_linux_manywheel_2.7mu_cu100_build
      - binary_linux_manywheel_3.5m_cu100_test:
          requires:
            - binary_linux_manywheel_3.5m_cu100_build
      - binary_linux_manywheel_3.6m_cu100_test:
          requires:
            - binary_linux_manywheel_3.6m_cu100_build
      - binary_linux_manywheel_3.7m_cu100_test:
          requires:
            - binary_linux_manywheel_3.7m_cu100_build
      - binary_linux_conda_2.7_cpu_test:
          requires:
            - binary_linux_conda_2.7_cpu_build
      - binary_linux_conda_3.5_cpu_test:
          requires:
            - binary_linux_conda_3.5_cpu_build
      - binary_linux_conda_3.6_cpu_test:
          requires:
            - binary_linux_conda_3.6_cpu_build
      - binary_linux_conda_3.7_cpu_test:
          requires:
            - binary_linux_conda_3.7_cpu_build
      - binary_linux_conda_2.7_cu80_test:
          requires:
            - binary_linux_conda_2.7_cu80_build
      - binary_linux_conda_3.5_cu80_test:
          requires:
            - binary_linux_conda_3.5_cu80_build
      - binary_linux_conda_3.6_cu80_test:
          requires:
            - binary_linux_conda_3.6_cu80_build
      - binary_linux_conda_3.7_cu80_test:
          requires:
            - binary_linux_conda_3.7_cu80_build
      - binary_linux_conda_2.7_cu90_test:
          requires:
            - binary_linux_conda_2.7_cu90_build
      - binary_linux_conda_3.5_cu90_test:
          requires:
            - binary_linux_conda_3.5_cu90_build
      - binary_linux_conda_3.6_cu90_test:
          requires:
            - binary_linux_conda_3.6_cu90_build
      - binary_linux_conda_3.7_cu90_test:
          requires:
            - binary_linux_conda_3.7_cu90_build
      - binary_linux_conda_2.7_cu100_test:
          requires:
            - binary_linux_conda_2.7_cu100_build
      - binary_linux_conda_3.5_cu100_test:
          requires:
            - binary_linux_conda_3.5_cu100_build
      - binary_linux_conda_3.6_cu100_test:
          requires:
            - binary_linux_conda_3.6_cu100_build
      - binary_linux_conda_3.7_cu100_test:
          requires:
            - binary_linux_conda_3.7_cu100_build
      #- binary_linux_libtorch_2.7m_cpu_test:
      #    requires:
      #      - binary_linux_libtorch_2.7m_cpu_build
      #- binary_linux_libtorch_2.7m_cu80_test:
      #    requires:
      #      - binary_linux_libtorch_2.7m_cu80_build
      #- binary_linux_libtorch_2.7m_cu90_test:
      #    requires:
      #      - binary_linux_libtorch_2.7m_cu90_build
      #- binary_linux_libtorch_2.7m_cu100_test:
      #    requires:
      #      - binary_linux_libtorch_2.7m_cu100_build

      # Nightly uploads
      - binary_linux_manywheel_2.7m_cpu_upload:
          context: org-member
          requires:
            - binary_linux_manywheel_2.7m_cpu_test
      - binary_linux_manywheel_2.7mu_cpu_upload:
          context: org-member
          requires:
            - binary_linux_manywheel_2.7mu_cpu_test
      - binary_linux_manywheel_3.5m_cpu_upload:
          context: org-member
          requires:
            - binary_linux_manywheel_3.5m_cpu_test
      - binary_linux_manywheel_3.6m_cpu_upload:
          context: org-member
          requires:
            - binary_linux_manywheel_3.6m_cpu_test
      - binary_linux_manywheel_3.7m_cpu_upload:
          context: org-member
          requires:
            - binary_linux_manywheel_3.7m_cpu_test
      - binary_linux_manywheel_2.7m_cu80_upload:
          context: org-member
          requires:
            - binary_linux_manywheel_2.7m_cu80_test
      - binary_linux_manywheel_2.7mu_cu80_upload:
          context: org-member
          requires:
            - binary_linux_manywheel_2.7mu_cu80_test
      - binary_linux_manywheel_3.5m_cu80_upload:
          context: org-member
          requires:
            - binary_linux_manywheel_3.5m_cu80_test
      - binary_linux_manywheel_3.6m_cu80_upload:
          context: org-member
          requires:
            - binary_linux_manywheel_3.6m_cu80_test
      - binary_linux_manywheel_3.7m_cu80_upload:
          context: org-member
          requires:
            - binary_linux_manywheel_3.7m_cu80_test
      - binary_linux_manywheel_2.7m_cu90_upload:
          context: org-member
          requires:
            - binary_linux_manywheel_2.7m_cu90_test
      - binary_linux_manywheel_2.7mu_cu90_upload:
          context: org-member
          requires:
            - binary_linux_manywheel_2.7mu_cu90_test
      - binary_linux_manywheel_3.5m_cu90_upload:
          context: org-member
          requires:
            - binary_linux_manywheel_3.5m_cu90_test
      - binary_linux_manywheel_3.6m_cu90_upload:
          context: org-member
          requires:
            - binary_linux_manywheel_3.6m_cu90_test
      - binary_linux_manywheel_3.7m_cu90_upload:
          context: org-member
          requires:
            - binary_linux_manywheel_3.7m_cu90_test
      - binary_linux_manywheel_2.7m_cu100_upload:
          context: org-member
          requires:
            - binary_linux_manywheel_2.7m_cu100_test
      - binary_linux_manywheel_2.7mu_cu100_upload:
          context: org-member
          requires:
            - binary_linux_manywheel_2.7mu_cu100_test
      - binary_linux_manywheel_3.5m_cu100_upload:
          context: org-member
          requires:
            - binary_linux_manywheel_3.5m_cu100_test
      - binary_linux_manywheel_3.6m_cu100_upload:
          context: org-member
          requires:
            - binary_linux_manywheel_3.6m_cu100_test
      - binary_linux_manywheel_3.7m_cu100_upload:
          context: org-member
          requires:
            - binary_linux_manywheel_3.7m_cu100_test
      - binary_linux_conda_2.7_cpu_upload:
          context: org-member
          requires:
            - binary_linux_conda_2.7_cpu_test
      - binary_linux_conda_3.5_cpu_upload:
          context: org-member
          requires:
            - binary_linux_conda_3.5_cpu_test
      - binary_linux_conda_3.6_cpu_upload:
          context: org-member
          requires:
            - binary_linux_conda_3.6_cpu_test
      - binary_linux_conda_3.7_cpu_upload:
          context: org-member
          requires:
            - binary_linux_conda_3.7_cpu_test
      - binary_linux_conda_2.7_cu80_upload:
          context: org-member
          requires:
            - binary_linux_conda_2.7_cu80_test
      - binary_linux_conda_3.5_cu80_upload:
          context: org-member
          requires:
            - binary_linux_conda_3.5_cu80_test
      - binary_linux_conda_3.6_cu80_upload:
          context: org-member
          requires:
            - binary_linux_conda_3.6_cu80_test
      - binary_linux_conda_3.7_cu80_upload:
          context: org-member
          requires:
            - binary_linux_conda_3.7_cu80_test
      - binary_linux_conda_2.7_cu90_upload:
          context: org-member
          requires:
            - binary_linux_conda_2.7_cu90_test
      - binary_linux_conda_3.5_cu90_upload:
          context: org-member
          requires:
            - binary_linux_conda_3.5_cu90_test
      - binary_linux_conda_3.6_cu90_upload:
          context: org-member
          requires:
            - binary_linux_conda_3.6_cu90_test
      - binary_linux_conda_3.7_cu90_upload:
          context: org-member
          requires:
            - binary_linux_conda_3.7_cu90_test
      - binary_linux_conda_2.7_cu100_upload:
          context: org-member
          requires:
            - binary_linux_conda_2.7_cu100_test
      - binary_linux_conda_3.5_cu100_upload:
          context: org-member
          requires:
            - binary_linux_conda_3.5_cu100_test
      - binary_linux_conda_3.6_cu100_upload:
          context: org-member
          requires:
            - binary_linux_conda_3.6_cu100_test
      - binary_linux_conda_3.7_cu100_upload:
          context: org-member
          requires:
            - binary_linux_conda_3.7_cu100_test
      - binary_linux_libtorch_2.7m_cpu_upload:
          context: org-member
          requires:
            - binary_linux_libtorch_2.7m_cpu_build
      - binary_linux_libtorch_2.7m_cu80_upload:
          context: org-member
          requires:
            - binary_linux_libtorch_2.7m_cu80_build
      - binary_linux_libtorch_2.7m_cu90_upload:
          context: org-member
          requires:
            - binary_linux_libtorch_2.7m_cu90_build
      - binary_linux_libtorch_2.7m_cu100_upload:
          context: org-member
          requires:
            - binary_linux_libtorch_2.7m_cu100_build
      - binary_macos_wheel_2.7_cpu_upload:
          context: org-member
          requires:
            - binary_macos_wheel_2.7_cpu_build
      - binary_macos_wheel_3.5_cpu_upload:
          context: org-member
          requires:
            - binary_macos_wheel_3.5_cpu_build
      - binary_macos_wheel_3.6_cpu_upload:
          context: org-member
          requires:
            - binary_macos_wheel_3.6_cpu_build
      - binary_macos_wheel_3.7_cpu_upload:
          context: org-member
          requires:
            - binary_macos_wheel_3.7_cpu_build
      - binary_macos_conda_2.7_cpu_upload:
          context: org-member
          requires:
            - binary_macos_conda_2.7_cpu_build
      - binary_macos_conda_3.5_cpu_upload:
          context: org-member
          requires:
            - binary_macos_conda_3.5_cpu_build
      - binary_macos_conda_3.6_cpu_upload:
          context: org-member
          requires:
            - binary_macos_conda_3.6_cpu_build
      - binary_macos_conda_3.7_cpu_upload:
          context: org-member
          requires:
            - binary_macos_conda_3.7_cpu_build
      - binary_macos_libtorch_2.7_cpu_upload:
          context: org-member
          requires:
            - binary_macos_libtorch_2.7_cpu_build

  # Scheduled to run 4 hours after the binary jobs start
  update_s3_htmls:
    triggers:
      - schedule:
          cron: "0 9 * * *"
          filters:
            branches:
              only:
                - master
    jobs:
      - update_s3_htmls:
          context: org-member
